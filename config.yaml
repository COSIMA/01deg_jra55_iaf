# PBS configuration
queue: normal
project: x77
walltime: 1:00:00
jobname: 01deg_jra55_ryf
ncpus: 6368
shortpath: /short/v45

# Model configuration
name: common
model: access-om2
input: /short/public/access-om2/input_38570c62/common_01deg_jra55
submodels:
    - name: atmosphere
      model: yatm
      exe: /short/v45/aek156/CHUCKABLE/OceansAus/access-om2-yatm/access-om2/bin/yatm_af01d11.exe
#      exe: /short/v45/aek156/CHUCKABLE/OceansAus/access-om2-yatm/access-om2/bin/yatm_84acdb8.exe
#      exe: /short/v45/aek156/access-om2/control/01deg_jra55_ryf/env-wrapper-yatm.sh
      input: /short/public/access-om2/input_38570c62/yatm_01deg
      ncpus: 1

    - name: ocean
      model: mom
      exe: /short/v45/aek156/CHUCKABLE/OceansAus/access-om2-yatm/access-om2/bin/fms_ACCESS-OM_cf63322_libaccessom2_af01d11.x
#      exe: /short/v45/aek156/CHUCKABLE/OceansAus/access-om2-yatm/access-om2/bin/fms_ACCESS-OM_bae32b6_libaccessom2_84acdb8.x
#      exe: /short/v45/aek156/access-om2/control/01deg_jra55_ryf/env-wrapper-mom.sh
      input: /short/public/access-om2/input_38570c62/mom_01deg
      ncpus: 4358

    - name: ice
      model: cice5
      exe: /short/v45/aek156/CHUCKABLE/OceansAus/access-om2-yatm/access-om2/bin/cice_auscom_3600x2700_2000p_0981e59_libaccessom2_af01d11.exe
#      exe: /short/v45/aek156/CHUCKABLE/OceansAus/access-om2-yatm/access-om2/bin/cice_auscom_3600x2700_2000p_a3391cb_libaccessom2_84acdb8.exe
#      exe: /short/v45/aek156/access-om2/control/01deg_jra55_ryf/env-wrapper-cice5.sh
      input: /short/public/access-om2/input_38570c62/cice_01deg
      ncpus: 2000

# Collation
collate: true
collate_walltime: 10:00:00
collate_mem: 128GB
collate_ncpus: 4
collate_queue: expressbw
collate_flags: -n4 -z -m -r

# Misc
runlog: True
stacksize: unlimited
# exe_prefix: /short/public/aph502/env-wrapper.sh
# mpirun: --mca orte_base_help_aggregate 0 --mca btl_openib_eager_limit 4096 --mca btl_openib_max_send_size 8192 --mca mtl mxm --mca pml cm  -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log
# mpirun: --mca orte_base_help_aggregate 0 --mca btl_openib_eager_limit 4096 --mca btl_openib_max_send_size 8192 --mca pml yalla  -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log
# Ben Menadue suggestion, email 2018-04-18
# mpirun: -mca coll ^fca --mca pml yalla -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log
# mpirun: --mca orte_base_help_aggregate 0 --mca pml yalla
mpirun: --mca pml yalla -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log
# Ben Menadue suggestion, email 2018-07-25
# mpirun: --mca pml yalla -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log --mca btl_base_verbose 100
# Ben Menadue suggestion, email 2018-07-26
# mpirun: --mca pml yalla -x MXM_LOG_FILE=$PBS_O_WORKDIR/$PBS_JOBID.mxm.log -x MXM_LOG_LEVEL=REQ -mca pml_base_verbose 100 -mca pml_yalla_verbose 100
# ipm: 2.0.5
qsub_flags: -lother=hyperthread -W umask=027
# for normalbw
# platform:
#    nodesize: 28
mpi:
    module: openmpi/1.10.2
# postscript: sync_output_to_gdata.sh
