# PBS configuration
queue: normal
project: x77
walltime: 5:00:00
jobname: 01deg_jra55_iaf
ncpus: 5968
shortpath: /short/v45

# Model configuration
name: common
model: access-om2
input: /short/public/access-om2/input_38570c62/common_01deg_jra55
submodels:
    - name: atmosphere
      model: yatm
      exe: /short/public/access-om2/bin/yatm_e8ad3723.exe
      input: /short/public/access-om2/input_38570c62/yatm_01deg
      ncpus: 1

    - name: ocean
      model: mom
      exe: /short/public/access-om2/bin/fms_ACCESS-OM_afe80bfd.x
      input: /short/public/access-om2/input_38570c62/mom_01deg
      ncpus: 4358

    - name: ice
      model: cice5
      exe: /short/public/access-om2/bin/cice_auscom_3600x2700_1392p_076b14f2.exe
      input: /short/public/access-om2/input_38570c62/cice_01deg
      ncpus: 1600

# Collation
collate:
    enable: true
    queue: express
    memory: 8GB
    walltime: 05:00:00
    mpi: true
    ncpus: 4
    threads: 2
    # flags: -v
    exe: /short/public/aph502/mppnccombine-fast

# Misc
runlog: True
stacksize: unlimited
restart_freq: 1
# exe_prefix: /short/public/aph502/env-wrapper.sh
# mpirun: --mca orte_base_help_aggregate 0 --mca btl_openib_eager_limit 4096 --mca btl_openib_max_send_size 8192 --mca mtl mxm --mca pml cm  -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log
# mpirun: --mca orte_base_help_aggregate 0 --mca btl_openib_eager_limit 4096 --mca btl_openib_max_send_size 8192 --mca pml yalla  -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log
# Ben Menadue suggestion, email 2018-04-18
# mpirun: -mca coll ^fca --mca pml yalla -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log
# mpirun: --mca orte_base_help_aggregate 0 --mca pml yalla
mpirun: --mca pml yalla -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log
# Marshall 2018-08-06
#mpirun:
#        - -mca orte_base_help_aggregate 0
#        - -mca orte_output_filename log
#        - -mca pml yalla 
#        - -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log
# Ben Menadue suggestion, email 2018-07-25
# mpirun: --mca pml yalla -x MXM_LOG_FILE=$PBS_JOBFS/mxm.log --mca btl_base_verbose 100
# Ben Menadue suggestion, email 2018-07-26
# mpirun: --mca pml yalla -x MXM_LOG_FILE=$PBS_O_WORKDIR/$PBS_JOBID.mxm.log -x MXM_LOG_LEVEL=REQ -mca pml_base_verbose 100 -mca pml_yalla_verbose 100
# ipm: 2.0.5
qsub_flags: -lother=hyperthread -W umask=027
# for normalbw
# platform:
#    nodesize: 28
mpi:
    module: openmpi/1.10.2
postscript: sync_output_to_gdata.sh
